---
import BaseLayout from "../../layouts/BaseLayout.astro";
import SiteHeader from "../../components/SiteHeader.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);

const ogImage = post.data.ogImage
	? post.data.ogImage
	: "https://christmastreeturner.com/images/unfurl.png";
---

<BaseLayout
	title={`${post.data.title} — ChristmasTreeTurner.com`}
	description={post.data.description}
	ogImage={ogImage}
>
	<SiteHeader />

	<main id="main-content" class="flex flex-col gap-8">
		<div>
			<a href="/blog" class="font-mono text-sm tracking-widest uppercase text-muted hover:text-text transition-colors mb-6 inline-block">&larr; Back to Updates</a>
		</div>

		<article>
			<header class="mb-10">
				<time class="font-mono text-xs tracking-widest uppercase text-muted" datetime={post.data.date.toISOString()}>
					{post.data.date.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}
				</time>
				<h1 class="uppercase tracking-tight text-4xl md:text-6xl italic mt-2 mb-4 text-red" style="font-family: 'Tay Highbeams', sans-serif;">
					{post.data.title}
				</h1>
				{post.data.tags && (
					<div class="flex flex-wrap gap-2">
						{post.data.tags.map((tag) => (
							<span class="font-mono text-xs tracking-widest uppercase text-muted border border-border px-2 py-0.5">
								{tag}
							</span>
						))}
					</div>
				)}
			</header>

			<div class="prose max-w-3xl">
				<Content />
			</div>
		</article>

		<!-- Newsletter CTA -->
		<div class="bg-accent text-white p-8 md:p-10 max-w-3xl mt-16">
			<h2 class="uppercase tracking-tight text-2xl italic mb-3" style="font-family: 'Tay Highbeams', sans-serif;">Friend & Family Updates</h2>
			<p class="text-white/80 text-sm mb-5 leading-relaxed">
				We're a small Texas family chasing a big Christmas mystery. If you're a fan of Christmas miracles, old-school detective work, or just want to stay in touch — drop your email and we'll keep you in the loop.
			</p>

			<form name="newsletter" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="grid md:grid-cols-[1fr_auto] gap-3">
				<input type="hidden" name="form-name" value="newsletter" />
				<div class="hidden" aria-hidden="true">
					<label for="post-newsletter-bot">Don't fill this out</label>
					<input id="post-newsletter-bot" name="bot-field" type="text" tabindex="-1" autocomplete="off" />
				</div>
				<div>
					<label for="post-newsletter-email" class="sr-only">Email address</label>
					<input
						id="post-newsletter-email"
						name="email"
						type="email"
						required
						placeholder="your@email.com"
						class="w-full border-0 p-3 font-serif bg-white text-text text-sm focus-visible:outline-2 focus-visible:outline-white focus-visible:outline-offset-2"
					/>
				</div>
				<button
					type="submit"
					class="py-3 px-6 bg-white text-accent font-mono text-xs uppercase tracking-widest cursor-pointer hover:bg-white/90 transition-colors focus-visible:outline-2 focus-visible:outline-white focus-visible:outline-offset-2"
				>
					Stay in Touch
				</button>
			</form>

			<p class="font-mono text-[10px] tracking-widest uppercase text-white/40 mt-4">No spam. Just updates, finds, and the occasional Christmas miracle.</p>
		</div>

		<!-- Footer -->
		<footer class="border-t border-border pt-16 mt-16">
			<p class="font-mono text-sm tracking-widest uppercase text-muted">
				This is a personal historical research project. No commercial use intended.
			</p>
			<p class="font-mono text-sm tracking-widest uppercase text-muted mt-2">
				Help, questions, and press inquiries: clark@superfun.team
			</p>
		</footer>
	</main>
</BaseLayout>

<style>
	.prose {
		font-family: var(--font-serif);
		color: var(--color-text);
		line-height: 1.8;
	}

	.prose :global(h2) {
		font-family: var(--font-display);
		text-transform: uppercase;
		letter-spacing: 0.05em;
		font-size: 1.5rem;
		margin-top: 2.5rem;
		margin-bottom: 1rem;
		color: var(--color-text);
	}

	.prose :global(h3) {
		font-family: var(--font-display);
		text-transform: uppercase;
		letter-spacing: 0.05em;
		font-size: 1.25rem;
		margin-top: 2rem;
		margin-bottom: 0.75rem;
		color: var(--color-text);
	}

	.prose :global(p) {
		margin-bottom: 1.25rem;
	}

	.prose :global(a) {
		color: var(--color-red);
		text-decoration: underline;
		text-underline-offset: 2px;
	}

	.prose :global(a:hover) {
		color: var(--color-accent);
	}

	.prose :global(strong) {
		font-weight: 700;
	}

	.prose :global(em) {
		font-style: italic;
	}

	.prose :global(ul),
	.prose :global(ol) {
		margin-bottom: 1.25rem;
		padding-left: 1.5rem;
	}

	.prose :global(ul) {
		list-style-type: disc;
	}

	.prose :global(ol) {
		list-style-type: decimal;
	}

	.prose :global(li) {
		margin-bottom: 0.5rem;
	}

	.prose :global(blockquote) {
		border-left: 3px solid var(--color-border);
		padding-left: 1.25rem;
		margin: 1.5rem 0;
		color: var(--color-muted);
		font-style: italic;
	}

	.prose :global(code) {
		font-family: var(--font-mono);
		font-size: 0.875em;
		background: var(--color-well);
		padding: 0.15em 0.35em;
		border-radius: 2px;
	}

	.prose :global(pre) {
		font-family: var(--font-mono);
		font-size: 0.875rem;
		background: var(--color-well);
		padding: 1.25rem;
		overflow-x: auto;
		margin: 1.5rem 0;
		border: 1px solid var(--color-border);
	}

	.prose :global(pre code) {
		background: none;
		padding: 0;
	}

	.prose :global(hr) {
		border: none;
		border-top: 1px solid var(--color-border);
		margin: 2rem 0;
	}

	.prose :global(img) {
		max-width: 100%;
		height: auto;
		margin: 1.5rem 0;
	}
</style>
